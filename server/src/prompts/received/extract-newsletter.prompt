---
model: openai/gpt-4o-mini
config:
  temperature: 0.2
response_format:
  type: json_object
input:
  schema:
    type: object
    properties:
      emailContent: 
        type: string
        description: "The main content/body of the email"
      emailDate:
        type: string
        description: "The date this email was sent/received in YYYY-MM-DD format"
      todaysDate:
        type: string
        description: "Today's date in YYYY-MM-DD format for temporal context"
      emailMetadata:
        type: object
        properties:
          subject:
            type: string
            description: "Email subject line"
          sender:
            type: string
            description: "Full sender information (Name <email@domain.com>)"
          senderDomain:
            type: string
            description: "Domain of the sender (e.g., dropbox.com, amazon.com)"
          to:
            type: string
            description: "Recipients in To field"
        required: [subject, sender, senderDomain]
      userInfo:
        type: object
        properties:
          firstName:
            type: string
          lastName:
            type: string
          email:
            type: string
        required: [firstName, lastName, email]
    required: [emailContent, emailDate, todaysDate, emailMetadata, userInfo]
output:
  schema:
    type: object
    properties:
      inferences:
        type: array
        items:
          type: object
          properties:
            categories:
              type: array
              items:
                type: string
                enum: [accounts, personal, professional]
              description: "Newsletter insights: subscription (accounts) and topic interests (personal/professional)"
              maxItems: 2
              minItems: 1
            insight:
              type: string
              description: "Factual statement about subscription relationship only"
            confidence:
              type: number
              minimum: 0.7
              maximum: 1
              description: "Confidence level - newsletters have reliable subscription evidence"
            evidence:
              type: string
              description: "Evidence of the subscription relationship"
            extractedOn:
              type: string
              description: "The email date for temporal context"
            reasoning:
              type: string
              description: "Brief explanation of why this is a subscription relationship"
          required: [categories, insight, confidence, evidence, extractedOn, reasoning]
    required: [inferences]
---
{{role "system"}}
You are an expert profile builder who extracts useful subscription insights from newsletters to help AI assistants understand people's interests and information consumption patterns.

{{role "user"}}
I need you to analyze this newsletter that {{userInfo.firstName}} {{userInfo.lastName}} received and extract useful profile insights about their interests and subscriptions.

{{>email-direction-understanding}}

{{>user-identity-awareness userInfo=userInfo}}

{{>profile-mission userInfo=userInfo}}

<analysis_focus>
You're analyzing a newsletter **TO** {{userInfo.firstName}} to understand:
- **What content they subscribe to** (publications, platforms, topics)
- **What subjects interest them** (professional, personal, industry focus)
- **Their information consumption patterns** (what types of content they value)
</analysis_focus>

<extraction_guidelines>
## WHAT TO EXTRACT

**Subscription Relationships (accounts):**
- Newsletter/publication name
- Platform (Substack, Medium, Beehiiv, etc.)
- Subscription status evidence

**Topic Interests (personal/professional):**
- Subject areas the newsletter covers
- Industry or domain focus
- Personal vs professional interest areas

**Interest Inference Logic:**
- Newsletter about technology → Interest in technology
- Business publication → Interest in business/entrepreneurship  
- Industry newsletter → Professional interest in that industry
- Lifestyle content → Personal interest in that topic
</extraction_guidelines>

{{>extraction-principles}}

<newsletter_specific_rules>
**Newsletter-Specific Logic:**
- Newsletter subscription → User receives this content type
- Publication focus → User interested in this subject area
- Platform usage → User has account on this platform

**Don't extract author's personal content as user attributes:**
- Author's experiences ≠ User's experiences
- Author's opinions ≠ User's opinions
- Author's location ≠ User's location
</newsletter_specific_rules>

{{>multi-turn-conversation-analysis emailMetadata=emailMetadata}}

{{>temporal-context emailDate=emailDate}}

---

<email_data>
**NEWSLETTER TO {{userInfo.firstName}}:**

**Date:** {{emailDate}}
**From:** {{emailMetadata.sender}}
**Subject:** {{emailMetadata.subject}}

**EMAIL CONTENT:**
{{emailContent}}
</email_data>

<task>
Extract subscription relationship and topic interests that help understand {{userInfo.firstName}}'s information consumption patterns and subject area interests. Focus on what their subscription choice reveals, not the author's personal content.
</task> 